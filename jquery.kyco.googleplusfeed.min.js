// jquery.kyco.googleplusfeed v1.0.3 brought to you by http://www.kyco.co.za. Copyright 2013 Cornelius Weidmann. Distributed under the GPL.
(function(e){var b={init:function(a){var f=e.extend({},{feedPosts:3,postsIncrement:3,maxPosts:20,profileImageSize:50,lang:"en"},a);return this.each(function(){function a(){function s(d){var a;a=""+('<div class="feed_post post_'+(d+1)+'">');var h="<span>"+f.lang.shared,g="",g="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),k="01;02;03;04;05;06;07; 08;09;10;11;12".split(";");if("en"===f.lang.langCode)g=c[d].publishedDate.substr(0,16);else var b=e.trim(c[d].publishedDate.substr(0,16).split(",")[1]).split(" "), g=b[0]+"."+k[g.indexOf(b[1])]+"."+b[2];a=a+(h+g+"</span>")+("<p>"+c[d].contentSnippet+"</p>");a+='<a href="'+c[d].link+'" target="_blank">'+f.lang.viewPost+"</a>";return a+="</div>"}var c=m.entries,h=c.length,k=f.feedPosts,b=f.postsIncrement,g=0,n=!1,w=0,t=k,p="",k=h<k?h:k;if(0<h){for(;w<k;w++)p+=s(w);y.children("a").attr("href",m.url).text(m.screenName);x.attr("href",m.url);x.append('<img src="'+m.image+'">');q.html(p);q.animate({scrollTop:0},1);d.fadeIn(300)}else d.children().remove(),r.text(f.lang.errorEmpty), u.text(f.lang.retryEmpty),r.append(u),d.append(r),d.fadeIn(300),d.find(".retry").click(function(){d.children().remove();d.append(l);l.show();m.getFeed()});v.click(function(){if(g<=h){g+=n?b:k+b;for(g=g>h?h:g;t<g;t++)p+=s(t),t===h-1&&(v.unbind("click").addClass("link"),v.text(f.lang.viewMore).click(function(){window.open(m.url)}));q.animate({scrollTop:q[0].scrollHeight},500);n=!0}q.html(p)})}var s=e(this);f.lang="en"===f.lang?{langCode:"en",loading:"Loading...",showMore:"Show more",viewMore:"View more posts on Google+", shared:"Shared publicly - ",viewPost:"View post",errorEmpty:"Nothing to show. Empty feed. ",retryEmpty:"Refresh",errorGeneral:"Unable to retrieve feed contents. ",retryGeneral:"Retry"}:{langCode:"de",loading:"Wird geladen...",showMore:"Mehr anzeigen",viewMore:"Weitere Beitr\u00e4ge ansehen bei Google+",shared:"\u00d6ffentlich geteilt - ",viewPost:"Beitrag ansehen",errorEmpty:"Nichts zu sehen. Keine Beitr\u00e4ge. ",retryEmpty:"Wiederholen",errorGeneral:"Es ist ein Fehler beim Abrufen der Beitr\u00e4ge aufgetreten. ", retryGeneral:"Wiederholen"};var n=e('<div id="feed_'+s.attr("class")+'" class="kyco_googleplusfeed '+f.lang.langCode+'"></div>'),l=e('<div class="feed_loader">'+f.lang.loading+"</div>"),d=e('<div class="feed_wrapper"></div>'),b=e('<div class="feed_header"></div>'),y=e('<h3 class="feed_screen_name"><a href="#" target="_blank"></a></h3>'),x=e('<a href="#" class="feed_profile_image" target="_blank"></a>'),q=e('<div class="feed_content"></div>'),v=e('<span class="feed_sow_more">'+f.lang.showMore+"</span>"), r=e('<div class="error"></div>'),u=e('<span class="retry"></span>');b.append(x,y);d.append(b,q,v);n.append(l,d);s.append(n);var m=new function(b){var c=this;c.id=b;c.image="https://plus.google.com/s2/photos/profile/"+c.id+"?sz="+f.profileImageSize;c.url="https://plus.google.com/"+c.id;c.init=function(){a()};c.getFeed=function(){e.ajax({url:"http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num="+f.maxPosts+"&callback=?&q="+encodeURIComponent("http://plusfeed.frosas.net/"+c.id),dataType:"json", success:function(a){try{c.raw=a;var b=a.responseData.feed.title;c.screenName=b.substr(0,b.indexOf("@")-1);c.entries=a.responseData.feed.entries;c.entries.forEach(function(a){a.contentSnippet=e(a.content).first().html()});e('<img src="'+c.image+'">').load(function(){l.fadeOut(300,function(){l.remove();c.init()})})}catch(s){l.fadeOut(300,function(){d.children().remove();r.text(f.lang.errorGeneral);u.text(f.lang.retryGeneral);r.append(u);d.append(r);d.fadeIn(300);d.find(".retry").click(function(){d.children().remove(); d.append(l);l.show();c.getFeed()})})}}})};c.getFeed()}(f.id)})}};e.fn.kycoGooglePlusFeed=function(a){"forEach"in Array.prototype||(Array.prototype.forEach=function(a,e){for(var b=0,n=this.length;b<n;b++)b in this&&a.call(e,this[b],b,this)});"string"===typeof a&&(a={id:a});if(b[a])return b[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof a&&a)e.error("Method "+a+" does not exist on jQuery.kycoGooglePlusFeed");else return b.init.apply(this,arguments)}})(jQuery);

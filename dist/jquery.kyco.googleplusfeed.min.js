/*
**
**  jquery.kyco.googleplusfeed
**  ==========================
**
**  Version 1.0.4
**
**  Brought to you by
**  https://kyco.io
**
*/

(function(d){var c={init:function(b){var f=d.extend({},{feedPosts:3,postsIncrement:3,maxPosts:20,profileImageSize:50,lang:"en"},b);return this.each(function(){function b(){function s(e){var b;b=""+('<div class="feed_post post_'+(e+1)+'">');var h="<span>"+f.lang.shared,g="",g="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),k="01;02;03;04;05;06;07; 08;09;10;11;12".split(";");if("en"===f.lang.langCode)g=a[e].publishedDate.substr(0,16);else var c=d.trim(a[e].publishedDate.substr(0,16).split(",")[1]).split(" "), g=c[0]+"."+k[g.indexOf(c[1])]+"."+c[2];b=b+(h+g+"</span>")+("<p>"+a[e].contentSnippet+"</p>");b+='<a href="'+a[e].link+'" target="_blank">'+f.lang.viewPost+"</a>";return b+="</div>"}var a=m.entries,h=a.length,k=f.feedPosts,c=f.postsIncrement,g=0,n=!1,w=0,t=k,p="",k=h<k?h:k;if(0<h){for(;w<k;w++)p+=s(w);y.children("a").attr("href",m.url).text(m.screenName);x.attr("href",m.url);x.append('<img src="'+m.image+'" width="'+f.profileImageSize+'" height="'+f.profileImageSize+'">');q.html(p);q.animate({scrollTop:0}, 1);e.fadeIn(300)}else e.children().remove(),r.text(f.lang.errorEmpty),u.text(f.lang.retryEmpty),r.append(u),e.append(r),e.fadeIn(300),e.find(".retry").click(function(){e.children().remove();e.append(l);l.show();m.getFeed()});v.click(function(){if(g<=h){g+=n?c:k+c;for(g=g>h?h:g;t<g;t++)p+=s(t),t===h-1&&(v.unbind("click").addClass("link"),v.text(f.lang.viewMore).click(function(){window.open(m.url)}));q.animate({scrollTop:q[0].scrollHeight},500);n=!0}q.html(p)})}var s=d(this);f.lang="en"===f.lang?{langCode:"en", loading:"Loading...",showMore:"Show more",viewMore:"View more posts on Google+",shared:"Shared publicly - ",viewPost:"View post",errorEmpty:"Nothing to show. Empty feed. ",retryEmpty:"Refresh",errorGeneral:"Unable to retrieve feed contents. ",retryGeneral:"Retry"}:{langCode:"de",loading:"Wird geladen...",showMore:"Mehr anzeigen",viewMore:"Weitere Beitr\u00e4ge ansehen bei Google+",shared:"\u00d6ffentlich geteilt - ",viewPost:"Beitrag ansehen",errorEmpty:"Nichts zu sehen. Keine Beitr\u00e4ge. ",retryEmpty:"Wiederholen", errorGeneral:"Es ist ein Fehler beim Abrufen der Beitr\u00e4ge aufgetreten. ",retryGeneral:"Wiederholen"};var n=d('<div id="feed_'+s.attr("class")+'" class="kyco_googleplusfeed '+f.lang.langCode+'"></div>'),l=d('<div class="feed_loader">'+f.lang.loading+"</div>"),e=d('<div class="feed_wrapper"></div>'),c=d('<div class="feed_header"></div>'),y=d('<h3 class="feed_screen_name"><a href="#" target="_blank"></a></h3>'),x=d('<a href="#" class="feed_profile_image" target="_blank"></a>'),q=d('<div class="feed_content"></div>'), v=d('<span class="feed_sow_more">'+f.lang.showMore+"</span>"),r=d('<div class="error"></div>'),u=d('<span class="retry"></span>');c.append(x,y);e.append(c,q,v);n.append(l,e);s.append(n);var m=new function(c){var a=this;a.id=c;a.image="https://plus.google.com/s2/photos/profile/"+a.id+"?sz="+f.profileImageSize;a.url="https://plus.google.com/"+a.id;a.init=function(){b()};console.log(a.image);a.getFeed=function(){d.ajax({url:"http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num="+f.maxPosts+"&callback=?&q="+ encodeURIComponent("http://plusfeed.frosas.net/"+a.id),dataType:"json",success:function(b){try{a.raw=b;var c=b.responseData.feed.title;a.screenName=c.substr(0,c.indexOf("@")-1);a.entries=b.responseData.feed.entries;a.entries.forEach(function(a){a.contentSnippet=d(a.content).first().html()});d.get(a.image).fail(function(){a.image="http://www.kycosoftware.com/images/general/googleplus-404.png"}).always(function(){d('<img src="'+a.image+'">').load(function(){l.fadeOut(300,function(){l.remove();a.init()})})})}catch(s){l.fadeOut(300, function(){e.children().remove();r.text(f.lang.errorGeneral);u.text(f.lang.retryGeneral);r.append(u);e.append(r);e.fadeIn(300);e.find(".retry").click(function(){e.children().remove();e.append(l);l.show();a.getFeed()})})}}})};a.getFeed()}(f.id)})}};d.fn.kycoGooglePlusFeed=function(b){"forEach"in Array.prototype||(Array.prototype.forEach=function(b,d){for(var c=0,n=this.length;c<n;c++)c in this&&b.call(d,this[c],c,this)});"string"===typeof b&&(b={id:b});if(c[b])return c[b].apply(this,Array.prototype.slice.call(arguments, 1));if("object"!==typeof b&&b)d.error("Method "+b+" does not exist on jQuery.kycoGooglePlusFeed");else return c.init.apply(this,arguments)}})(jQuery);
